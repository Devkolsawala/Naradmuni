<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Naradmuni - Your Life Guide</title>
    <!-- Google Identity Services -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Light theme */
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-tertiary: #f1f3f4;
            --text-primary: #1a1a1a;
            --text-secondary: #5f6368;
            --text-tertiary: #80868b;
            --accent-primary: #ff6b35;
            --accent-secondary: #ff8f65;
            --accent-tertiary: #fff4f1;
            --border-light: #e8eaed;
            --border-medium: #dadce0;
            --shadow-light: rgba(0, 0, 0, 0.05);
            --shadow-medium: rgba(0, 0, 0, 0.1);
            --success: #34a853;
            --warning: #fbbc04;
            --error: #ea4335;
            --sidebar-width: 320px;
        }

        [data-theme="dark"] {
            /* Dark theme */
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --bg-tertiary: #3c3c3c;
            --text-primary: #e8eaed;
            --text-secondary: #9aa0a6;
            --text-tertiary: #5f6368;
            --accent-primary: #ff6b35;
            --accent-secondary: #ff8f65;
            --accent-tertiary: #3d2317;
            --border-light: #3c4043;
            --border-medium: #5f6368;
            --shadow-light: rgba(0, 0, 0, 0.2);
            --shadow-medium: rgba(0, 0, 0, 0.3);
            --success: #34a853;
            --warning: #fbbc04;
            --error: #ea4335;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            line-height: 1.6;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .app {
            display: flex;
            height: 100vh;
            width: 100vw;
            background: var(--bg-primary);
            position: relative;
            overflow: hidden;
        }

        /* Enhanced Sidebar Styles */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-light);
            transform: translateX(-100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            box-shadow: 4px 0 20px var(--shadow-medium);
            backdrop-filter: blur(10px);
        }

        .sidebar.open {
            transform: translateX(0);
        }

        .sidebar-header {
            padding: 2rem 1.5rem;
            border-bottom: 1px solid var(--border-light);
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: linear-gradient(135deg, var(--accent-tertiary) 0%, transparent 100%);
        }

        .sidebar-logo {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .sidebar-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 18px;
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
        }

        .sidebar-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent-primary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .sidebar-close {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-light);
            color: var(--text-secondary);
            cursor: pointer;
            padding: 0.75rem;
            border-radius: 10px;
            transition: all 0.2s ease;
            font-size: 1.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sidebar-close:hover {
            background: var(--accent-primary);
            color: white;
            border-color: var(--accent-primary);
            transform: scale(1.05);
        }

        .sidebar-content {
            flex: 1;
            padding: 2rem 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 2.5rem;
            overflow-y: auto;
        }

        .sidebar-section {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .sidebar-section h3 {
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .sidebar-section h3::before {
            content: '';
            height: 2px;
            background: var(--accent-primary);
            flex: 1;
        }

        .feature-card {
            background: var(--bg-primary);
            border: 2px solid var(--border-light);
            border-radius: 16px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .feature-card:hover {
            border-color: var(--accent-primary);
            box-shadow: 0 8px 32px rgba(255, 107, 53, 0.15);
            transform: translateY(-2px);
        }

        .feature-card:hover::before {
            opacity: 1;
        }

        .feature-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, var(--accent-tertiary) 0%, transparent 100%);
        }

        .feature-card h4 {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .feature-card p {
            font-size: 0.875rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .stat-item {
            background: var(--bg-primary);
            border: 1px solid var(--border-light);
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-primary);
            display: block;
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Enhanced Header */
        .header {
            background: var(--bg-primary);
            border-bottom: 2px solid var(--border-light);
            padding: 1.25rem 2rem;
            display: flex;
            align-items: center;
            gap: 1.25rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 16px var(--shadow-light);
            flex-shrink: 0;
            backdrop-filter: blur(10px);
        }

        .menu-button {
            background: var(--bg-tertiary);
            border: 2px solid var(--border-light);
            color: var(--text-secondary);
            cursor: pointer;
            padding: 0.875rem;
            border-radius: 12px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .menu-button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: var(--accent-primary);
            border-radius: 50%;
            transition: all 0.3s ease;
            transform: translate(-50%, -50%);
            z-index: -1;
        }

        .menu-button:hover {
            border-color: var(--accent-primary);
            color: white;
            transform: scale(1.05);
        }

        .menu-button:hover::before {
            width: 100px;
            height: 100px;
        }

        .header-avatar {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 20px;
            box-shadow: 0 6px 16px rgba(255, 107, 53, 0.4);
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { box-shadow: 0 6px 16px rgba(255, 107, 53, 0.4); }
            to { box-shadow: 0 8px 24px rgba(255, 107, 53, 0.6); }
        }

        .header-content {
            display: flex;
            flex-direction: column;
        }

        .header-title {
            font-size: 1.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent-primary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-subtitle {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* Enhanced Auth Section */
        .auth-section {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .login-container {
            display: flex;
            align-items: center;
            gap: 1rem;
            background: var(--bg-tertiary);
            border: 2px solid var(--border-light);
            border-radius: 16px;
            padding: 0.75rem 1.25rem;
            transition: all 0.3s ease;
        }

        .login-container:hover {
            border-color: var(--accent-primary);
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.2);
        }

        .login-text {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .google-signin-button {
            background: #4285f4;
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-family: 'Roboto', sans-serif;
            font-size: 14px;
            font-weight: 500;
            padding: 8px 16px;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .google-signin-button:hover {
            background: #3367d6;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
            transform: translateY(-1px);
        }

        /* Enhanced Profile Menu */
        .profile-menu {
            position: relative;
        }

        .profile-button {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            background: var(--bg-tertiary);
            border: 2px solid var(--border-light);
            border-radius: 16px;
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .profile-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 107, 53, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .profile-button:hover {
            background: var(--accent-tertiary);
            border-color: var(--accent-primary);
            transform: scale(1.02);
        }

        .profile-button:hover::before {
            left: 100%;
        }

        .profile-avatar {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            border: 2px solid var(--accent-primary);
        }

        .profile-info {
            display: flex;
            flex-direction: column;
        }

        .profile-name {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-primary);
            max-width: 120px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .profile-email {
            font-size: 0.75rem;
            color: var(--text-secondary);
            max-width: 120px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .profile-dropdown {
            position: absolute;
            top: calc(100% + 0.75rem);
            right: 0;
            background: var(--bg-primary);
            border: 2px solid var(--border-light);
            border-radius: 16px;
            box-shadow: 0 12px 32px var(--shadow-medium);
            padding: 0.75rem;
            min-width: 240px;
            z-index: 1001;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-20px) scale(0.95);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .profile-dropdown.open {
            opacity: 1;
            visibility: visible;
            transform: translateY(0) scale(1);
        }

        .profile-menu-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--text-primary);
            text-decoration: none;
            font-weight: 500;
        }

        .profile-menu-item:hover {
            background: var(--bg-tertiary);
            transform: translateX(4px);
        }

        .profile-menu-item.theme-toggle {
            justify-content: space-between;
        }

        .theme-toggle-switch {
            width: 48px;
            height: 24px;
            background: var(--border-medium);
            border-radius: 12px;
            position: relative;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .theme-toggle-switch::before {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: var(--bg-primary);
            border-radius: 50%;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 6px var(--shadow-medium);
        }

        [data-theme="dark"] .theme-toggle-switch {
            background: var(--accent-primary);
        }

        [data-theme="dark"] .theme-toggle-switch::before {
            transform: translateX(24px);
        }

        .menu-divider {
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--border-light), transparent);
            margin: 0.75rem 0;
        }

        /* Enhanced Welcome Area */
        .welcome-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 4rem 2rem;
            text-align: center;
            animation: fadeInUp 0.8s ease-out;
        }

        @keyframes fadeInUp {
            from { 
                opacity: 0; 
                transform: translateY(40px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }

        .welcome-hero {
            margin-bottom: 4rem;
        }

        .welcome-avatar {
            width: 140px;
            height: 140px;
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            border-radius: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 64px;
            font-weight: 800;
            margin: 0 auto 2.5rem;
            box-shadow: 0 16px 48px rgba(255, 107, 53, 0.4);
            animation: float 3s ease-in-out infinite;
            position: relative;
        }

        .welcome-avatar::before {
            content: '';
            position: absolute;
            top: -4px;
            left: -4px;
            right: -4px;
            bottom: -4px;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 39px;
            z-index: -1;
            opacity: 0.3;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.05); }
        }

        .welcome-content h2 {
            font-size: 3rem;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent-primary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .welcome-content p {
            color: var(--text-secondary);
            font-size: 1.25rem;
            margin-bottom: 3rem;
            max-width: 700px;
            font-weight: 400;
            line-height: 1.7;
        }

        /* Enhanced Suggestions Grid */
        .suggestions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 1.5rem;
            max-width: 1000px;
            width: 100%;
        }

        .suggestion-card {
            background: var(--bg-secondary);
            border: 2px solid var(--border-light);
            border-radius: 20px;
            padding: 2rem;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: left;
            position: relative;
            overflow: hidden;
        }

        .suggestion-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            transform: scaleX(0);
            transition: transform 0.4s ease;
            border-radius: 20px 20px 0 0;
        }

        .suggestion-card::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: radial-gradient(circle, rgba(255, 107, 53, 0.1) 0%, transparent 70%);
            border-radius: 50%;
            transition: all 0.4s ease;
            transform: translate(-50%, -50%);
            z-index: 0;
        }

        .suggestion-card:hover {
            border-color: var(--accent-primary);
            box-shadow: 0 12px 40px rgba(255, 107, 53, 0.2);
            transform: translateY(-8px) scale(1.02);
        }

        .suggestion-card:hover::before {
            transform: scaleX(1);
        }

        .suggestion-card:hover::after {
            width: 300px;
            height: 300px;
        }

        .suggestion-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--accent-tertiary) 0%, transparent 100%);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            margin-bottom: 1.5rem;
            position: relative;
            z-index: 1;
        }

        .suggestion-card h4 {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.75rem;
            position: relative;
            z-index: 1;
        }

        .suggestion-card p {
            font-size: 0.95rem;
            color: var(--text-secondary);
            margin: 0;
            line-height: 1.6;
            position: relative;
            z-index: 1;
        }

        /* Enhanced Chat Area */
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            padding: 0 2rem;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        .messages {
            flex: 1;
            overflow-y: auto;
            padding: 2.5rem 0;
            scroll-behavior: smooth;
        }

        .messages::-webkit-scrollbar {
            width: 8px;
        }

        .messages::-webkit-scrollbar-track {
            background: transparent;
            border-radius: 4px;
        }

        .messages::-webkit-scrollbar-thumb {
            background: var(--border-medium);
            border-radius: 4px;
            transition: background 0.2s ease;
        }

        .messages::-webkit-scrollbar-thumb:hover {
            background: var(--accent-primary);
        }

        .message {
            margin-bottom: 2.5rem;
            animation: slideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideIn {
            from { 
                opacity: 0; 
                transform: translateY(30px) scale(0.95); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0) scale(1); 
            }
        }

        .message.user {
            display: flex;
            justify-content: flex-end;
        }

        .message.bot {
            display: flex;
            justify-content: flex-start;
        }

        .message-bubble {
            max-width: 75%;
            padding: 1.5rem 2rem;
            border-radius: 24px;
            position: relative;
            box-shadow: 0 4px 16px var(--shadow-light);
            backdrop-filter: blur(10px);
        }

        .message.user .message-bubble {
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            color: white;
            border-bottom-right-radius: 8px;
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.3);
        }

        .message.bot .message-bubble {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 2px solid var(--border-light);
            border-bottom-left-radius: 8px;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 700;
            margin-right: 1rem;
            flex-shrink: 0;
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.4);
        }

        /* Enhanced Input Area */
        .input-area {
            padding: 2.5rem 0;
            background: var(--bg-primary);
            border-top: 2px solid var(--border-light);
            flex-shrink: 0;
        }

        .input-container {
            position: relative;
            display: flex;
            align-items: flex-end;
            gap: 1.25rem;
            max-width: 900px;
            margin: 0 auto;
        }

        .input-wrapper {
            flex: 1;
            position: relative;
        }

        .message-input {
            width: 100%;
            min-height: 60px;
            max-height: 200px;
            padding: 1.25rem 1.5rem;
            padding-right: 5rem;
            border: 3px solid var(--border-light);
            border-radius: 30px;
            outline: none;
            resize: none;
            font-family: inherit;
            font-size: 1rem;
            line-height: 1.5;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 16px var(--shadow-light);
        }

        .message-input:focus {
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 6px rgba(255, 107, 53, 0.15);
            transform: scale(1.01);
        }

        .character-counter {
            position: absolute;
            right: 1.5rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-tertiary);
            pointer-events: none;
            background: var(--bg-secondary);
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
            border: 1px solid var(--border-light);
        }

        .character-counter.warning {
            color: var(--warning);
            border-color: var(--warning);
        }

        .character-counter.error {
            color: var(--error);
            border-color: var(--error);
        }

        .send-button {
            padding: 1.25rem 2rem;
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-weight: 700;
            font-size: 1rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            height: 60px;
            display: flex;
            align-items: center;
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.4);
            transform: scale(1);
            position: relative;
            overflow: hidden;
        }

        .send-button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transition: all 0.3s ease;
            transform: translate(-50%, -50%);
        }

        .send-button:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 8px 28px rgba(255, 107, 53, 0.5);
        }

        .send-button:hover:not(:disabled)::before {
            width: 200px;
            height: 200px;
        }

        .send-button:active:not(:disabled) {
            transform: scale(0.98);
        }

        .send-button:disabled {
            background: var(--text-tertiary);
            cursor: not-allowed;
            transform: scale(1);
            box-shadow: none;
        }

        /* Enhanced Loading States */
        .loading-message {
            display: flex;
            justify-content: flex-start;
            margin-bottom: 2.5rem;
            animation: slideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .loading-bubble {
            background: var(--bg-secondary);
            border: 2px solid var(--border-light);
            border-radius: 24px;
            border-bottom-left-radius: 8px;
            padding: 1.5rem 2rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            box-shadow: 0 4px 16px var(--shadow-light);
        }

        .loading-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 16px;
            margin-right: 1rem;
        }

        .loading-content {
            display: flex;
            align-items: center;
            gap: 1rem;
            color: var(--text-secondary);
            font-size: 1rem;
            font-weight: 500;
        }

        .thinking-animation {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .brain-icon {
            font-size: 1.5rem;
            animation: bounce 1.5s ease-in-out infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .loading-dots {
            display: flex;
            gap: 6px;
            align-items: center;
        }

        .loading-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--accent-primary);
            animation: loading-pulse 1.5s infinite ease-in-out;
        }

        .loading-dot:nth-child(1) { animation-delay: -0.3s; }
        .loading-dot:nth-child(2) { animation-delay: -0.15s; }
        .loading-dot:nth-child(3) { animation-delay: 0s; }

        @keyframes loading-pulse {
            0%, 80%, 100% {
                opacity: 0.3;
                transform: scale(0.8);
            }
            40% {
                opacity: 1;
                transform: scale(1.2);
            }
        }

        /* Enhanced Error Messages */
        .error-message, .token-limit-message, .character-limit-message {
            background: var(--bg-secondary);
            border: 2px solid var(--error);
            color: var(--error);
            padding: 1.5rem 2rem;
            border-radius: 16px;
            margin: 1.5rem 0;
            font-size: 1rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 1rem;
            animation: slideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 16px rgba(234, 67, 53, 0.1);
        }

        .token-limit-message, .character-limit-message {
            border-color: var(--warning);
            color: var(--warning);
            box-shadow: 0 4px 16px rgba(251, 188, 4, 0.1);
        }

        .message-content {
            font-size: 1rem;
            line-height: 1.7;
        }

        .formatted-message p {
            margin-bottom: 1.2rem;
        }

        .formatted-message p:last-child {
            margin-bottom: 0;
        }

        .formatted-message strong {
            font-weight: 700;
        }

        .message.user .formatted-message strong {
            color: rgba(255, 255, 255, 0.95);
        }

        .message.bot .formatted-message strong {
            color: var(--accent-primary);
        }

        .formatted-message ul, .formatted-message ol {
            margin: 1.2rem 0;
            padding-left: 2rem;
        }

        .formatted-message li {
            margin-bottom: 0.75rem;
        }

        /* Enhanced Overlay */
        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.6);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            backdrop-filter: blur(4px);
        }

        .sidebar-overlay.visible {
            opacity: 1;
            visibility: visible;
        }

        /* Status Indicator */
        .status-indicator {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--success);
            color: white;
            padding: 0.75rem 1.25rem;
            border-radius: 12px;
            font-size: 0.875rem;
            font-weight: 600;
            box-shadow: 0 4px 16px rgba(52, 168, 83, 0.3);
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px);
            transition: all 0.3s ease;
        }

        .status-indicator.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .status-indicator.error {
            background: var(--error);
            box-shadow: 0 4px 16px rgba(234, 67, 53, 0.3);
        }

        .status-indicator.warning {
            background: var(--warning);
            box-shadow: 0 4px 16px rgba(251, 188, 4, 0.3);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .sidebar {
                width: 100vw;
            }

            .header {
                padding: 1.25rem;
            }
            
            .header-title {
                font-size: 1.25rem;
            }

            .header-subtitle {
                display: none;
            }

            .chat-container {
                padding: 0 1.25rem;
            }

            .message-bubble {
                max-width: 90%;
            }

            .input-area {
                padding: 1.5rem 0;
            }

            .input-container {
                margin: 0;
            }

            .suggestions-grid {
                grid-template-columns: 1fr;
            }

            .welcome-area {
                padding: 2.5rem 1.25rem;
            }

            .welcome-content h2 {
                font-size: 2.25rem;
            }

            .welcome-avatar {
                width: 100px;
                height: 100px;
                font-size: 48px;
            }

            .profile-info {
                display: none;
            }

            .login-text {
                display: none;
            }

            .menu-button {
                padding: 0.75rem;
            }

            .header-avatar {
                width: 40px;
                height: 40px;
                font-size: 16px;
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 1rem;
            }

            .chat-container {
                padding: 0 1rem;
            }

            .input-area {
                padding: 1.25rem 0;
            }

            .message-input {
                min-height: 50px;
                padding: 1rem 1.25rem;
                padding-right: 4.5rem;
                font-size: 0.95rem;
            }

            .send-button {
                height: 50px;
                padding: 1rem 1.5rem;
                font-size: 0.9rem;
            }

            .welcome-content h2 {
                font-size: 2rem;
            }

            .welcome-avatar {
                width: 80px;
                height: 80px;
                font-size: 36px;
                border-radius: 20px;
            }
        }
    </style>
</head>
<body data-theme="light">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const API_URL = '/chat';

        // Get Google Client ID from environment (this would be set by your backend)
        const GOOGLE_CLIENT_ID = window.GOOGLE_CLIENT_ID || "YOUR_GOOGLE_CLIENT_ID_HERE";

        function formatMessage(content) {
            let formatted = content;
            
            // Convert **text** to <strong>text</strong>
            formatted = formatted.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            
            // Convert bullet points to proper list items
            const lines = formatted.split('\n');
            let inList = false;
            let result = '';
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                
                if (line.match(/^[-•]\s/)) {
                    if (!inList) {
                        result += '<ul>';
                        inList = true;
                    }
                    result += '<li>' + line.replace(/^[-•]\s/, '') + '</li>';
                } else if (line.match(/^\d+\.\s/)) {
                    if (!inList) {
                        result += '<ol>';
                        inList = true;
                    }
                    result += '<li>' + line.replace(/^\d+\.\s/, '') + '</li>';
                } else {
                    if (inList) {
                        result += inList === 'ul' ? '</ul>' : '</ol>';
                        inList = false;
                    }
                    if (line) {
                        result += '<p>' + line + '</p>';
                    }
                }
            }
            
            if (inList) {
                result += inList === 'ul' ? '</ul>' : '</ol>';
            }
            
            return result;
        }

        function App() {
            const [messages, setMessages] = useState([]);
            const [inputMessage, setInputMessage] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [error, setError] = useState('');
            const [tokenLimitExceeded, setTokenLimitExceeded] = useState(false);
            const [characterLimitExceeded, setCharacterLimitExceeded] = useState(false);
            const [theme, setTheme] = useState(() => {
                return localStorage.getItem('naradmuni-theme') || 'light';
            });
            const [sidebarOpen, setSidebarOpen] = useState(false);
            const [characterCount, setCharacterCount] = useState(0);
            const [user, setUser] = useState(null);
            const [profileMenuOpen, setProfileMenuOpen] = useState(false);
            const [googleSignInReady, setGoogleSignInReady] = useState(false);
            const [statusMessage, setStatusMessage] = useState('');
            const [statusType, setStatusType] = useState('success');
            const [thinkingMessages] = useState([
                "Contemplating your wisdom...",
                "Channeling ancient insights...",
                "Reflecting on your question...",
                "Gathering thoughtful guidance...",
                "Processing with care..."
            ]);
            const [currentThinkingMessage, setCurrentThinkingMessage] = useState(0);
            const messagesEndRef = useRef(null);
            const profileMenuRef = useRef(null);
            const googleButtonRef = useRef(null);

            const CHARACTER_LIMIT = 500; // Increased limit

            const suggestions = [
                {
                    icon: "🧠",
                    title: "Stress & Anxiety Management",
                    description: "Learn effective techniques to handle daily stress, anxiety, and maintain inner peace through mindfulness and practical strategies",
                    prompt: "I'm feeling overwhelmed with stress and anxiety. Can you help me with some effective coping strategies?"
                },
                {
                    icon: "💝",
                    title: "Relationship Guidance",
                    description: "Get thoughtful advice on building and maintaining healthy relationships, communication skills, and resolving conflicts",
                    prompt: "I'm having challenges in my relationship and need guidance on how to communicate better and strengthen our bond"
                },
                {
                    icon: "⚖️",
                    title: "Life Balance & Purpose",
                    description: "Discover harmony between work, personal life, spiritual growth, and finding your life's purpose",
                    prompt: "I feel lost and struggling to find balance between work and personal life. How can I discover my purpose and create harmony?"
                },
                {
                    icon: "🌱",
                    title: "Personal Growth",
                    description: "Guidance on self-improvement, building confidence, overcoming limiting beliefs, and developing emotional intelligence",
                    prompt: "I want to work on personal growth and become the best version of myself. Where should I start?"
                },
                {
                    icon: "🎯",
                    title: "Career & Life Decisions",
                    description: "Navigate important life choices, career transitions, and make decisions aligned with your values and goals",
                    prompt: "I'm at a crossroads in my career and life. Can you help me make better decisions and find the right path?"
                },
                {
                    icon: "🕊️",
                    title: "Mindfulness & Spirituality",
                    description: "Explore mindfulness practices, spiritual growth, meditation techniques, and finding inner peace",
                    prompt: "I want to develop a deeper spiritual practice and learn mindfulness techniques for inner peace"
                }
            ];

            // Show status message
            const showStatus = (message, type = 'success') => {
                setStatusMessage(message);
                setStatusType(type);
                setTimeout(() => setStatusMessage(''), 3000);
            };

            // Apply theme and check authentication on mount
            useEffect(() => {
                document.body.setAttribute('data-theme', theme);
                localStorage.setItem('naradmuni-theme', theme);
                checkAuthStatus();
                initializeGoogleSignIn();
            }, []);

            // Theme change effect
            useEffect(() => {
                document.body.setAttribute('data-theme', theme);
                localStorage.setItem('naradmuni-theme', theme);
            }, [theme]);

            // Thinking message rotation effect
            useEffect(() => {
                let interval;
                if (isLoading) {
                    interval = setInterval(() => {
                        setCurrentThinkingMessage(prev => (prev + 1) % thinkingMessages.length);
                    }, 2500);
                }
                return () => clearInterval(interval);
            }, [isLoading, thinkingMessages.length]);

            // Click outside to close profile menu
            useEffect(() => {
                const handleClickOutside = (event) => {
                    if (profileMenuRef.current && !profileMenuRef.current.contains(event.target)) {
                        setProfileMenuOpen(false);
                    }
                };

                document.addEventListener('mousedown', handleClickOutside);
                return () => {
                    document.removeEventListener('mousedown', handleClickOutside);
                };
            }, []);

            // Check if user is authenticated
            const checkAuthStatus = async () => {
                try {
                    const res = await fetch('/auth/me', { credentials: 'include' });
                    if (res.ok) {
                        const data = await res.json();
                        setUser(data.user);
                    }
                } catch (e) {
                    console.log('User not authenticated');
                }
            };

            // Initialize Google Sign-In
            const initializeGoogleSignIn = () => {
                const checkGoogleLoaded = () => {
                    if (window.google && window.google.accounts) {
                        try {
                            window.google.accounts.id.initialize({
                                client_id: GOOGLE_CLIENT_ID,
                                callback: handleCredentialResponse,
                                auto_select: false,
                                cancel_on_tap_outside: true
                            });
                            setGoogleSignInReady(true);
                        } catch (error) {
                            console.error('Google Sign-In initialization failed:', error);
                            setTimeout(checkGoogleLoaded, 1000);
                        }
                    } else {
                        setTimeout(checkGoogleLoaded, 500);
                    }
                };

                checkGoogleLoaded();
            };

            // Render Google Sign-In button
            const renderGoogleSignInButton = () => {
                if (!googleSignInReady || user) return null;

                return (
                    <button 
                        className="google-signin-button"
                        onClick={() => {
                            if (window.google && window.google.accounts) {
                                window.google.accounts.id.prompt((notification) => {
                                    if (notification.isNotDisplayed() || notification.isSkippedMoment()) {
                                        // Fallback to renderButton if prompt doesn't work
                                        if (googleButtonRef.current) {
                                            googleButtonRef.current.innerHTML = '';
                                            window.google.accounts.id.renderButton(
                                                googleButtonRef.current,
                                                { 
                                                    theme: theme === 'dark' ? 'filled_black' : 'outline',
                                                    size: 'medium',
                                                    type: 'standard',
                                                    text: 'signin_with'
                                                }
                                            );
                                        }
                                    }
                                });
                            }
                        }}
                    >
                        <svg width="18" height="18" viewBox="0 0 24 24">
                            <path fill="#4285f4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                            <path fill="#34a853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                            <path fill="#fbbc05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                            <path fill="#ea4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                        </svg>
                        Sign in with Google
                    </button>
                );
            };

            // Handle Google credential response
            const handleCredentialResponse = async (response) => {
                try {
                    const res = await fetch('/auth/google', {
                        method: 'POST',
                        credentials: 'include',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ credential: response.credential })
                    });
                    const data = await res.json();
                    if (res.ok && data.success) {
                        setUser(data.user);
                        showStatus(`Welcome, ${data.user.name}! 🙏`);
                    } else {
                        console.error('Login failed', data);
                        setError('Login failed. Please try again.');
                        showStatus('Login failed. Please try again.', 'error');
                    }
                } catch (err) {
                    console.error('Auth error', err);
                    setError('Authentication error. Please try again.');
                    showStatus('Authentication error. Please try again.', 'error');
                }
            };

            // Handle logout
            const handleLogout = async () => {
                try {
                    await fetch('/auth/logout', { method: 'POST', credentials: 'include' });
                    setUser(null);
                    setMessages([]);
                    setProfileMenuOpen(false);
                    showStatus('Signed out successfully', 'warning');
                } catch (err) {
                    console.error('Logout error', err);
                }
            };

            useEffect(() => {
                setCharacterCount(inputMessage.length);
                setCharacterLimitExceeded(inputMessage.length > CHARACTER_LIMIT);
            }, [inputMessage]);

            const toggleSidebar = () => {
                setSidebarOpen(prev => !prev);
            };

            const closeSidebar = () => {
                setSidebarOpen(false);
            };

            const toggleTheme = () => {
                setTheme(prev => {
                    const newTheme = prev === 'light' ? 'dark' : 'light';
                    showStatus(`Switched to ${newTheme} mode`);
                    return newTheme;
                });
                setProfileMenuOpen(false);
            };

            const toggleProfileMenu = () => {
                setProfileMenuOpen(prev => !prev);
            };

            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
            };

            useEffect(() => {
                scrollToBottom();
            }, [messages, isLoading]);

            const sendMessage = async (messageText = inputMessage) => {
                const message = messageText.trim();
                if (!message || isLoading || message.length > CHARACTER_LIMIT) return;

                // Check if user is authenticated
                if (!user) {
                    setError('Please sign in to start chatting with Naradmuni.');
                    showStatus('Please sign in to continue', 'warning');
                    return;
                }

                // Reset error states
                setError('');
                setTokenLimitExceeded(false);
                setCharacterLimitExceeded(false);

                const userMessage = {
                    id: Date.now(),
                    type: 'user',
                    content: message
                };

                setMessages(prev => [...prev, userMessage]);
                setInputMessage('');
                setIsLoading(true);
                setCurrentThinkingMessage(0);

                try {
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        credentials: 'include',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ message: message })
                    });

                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({}));
                        
                        // Check for authentication error
                        if (response.status === 401) {
                            setUser(null);
                            setError('Your session has expired. Please sign in again.');
                            showStatus('Session expired. Please sign in again.', 'error');
                            return;
                        }
                        
                        // Check for token limit exceeded
                        if (response.status === 429 || errorData.detail?.includes('rate') || errorData.detail?.includes('limit')) {
                            setTokenLimitExceeded(true);
                            showStatus('Rate limit reached. Please wait before sending another message.', 'warning');
                            return;
                        }
                        
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const data = await response.json();
                    
                    const botMessage = {
                        id: Date.now() + 1,
                        type: 'bot',
                        content: data.reply
                    };

                    setMessages(prev => [...prev, botMessage]);
                    showStatus('Response received ✨');
                } catch (err) {
                    console.error('Error:', err);
                    setError('I apologize, but I\'m having trouble connecting at the moment. Please try again shortly.');
                    showStatus('Connection error. Please try again.', 'error');
                } finally {
                    setIsLoading(false);
                }
            };

            const handleKeyPress = (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    if (!characterLimitExceeded && characterCount <= CHARACTER_LIMIT) {
                        sendMessage();
                    }
                }
            };

            const handleInputChange = (e) => {
                const value = e.target.value;
                if (value.length <= CHARACTER_LIMIT) {
                    setInputMessage(value);
                }
            };

            const handleSuggestionClick = (prompt) => {
                if (!user) {
                    setError('Please sign in to start chatting with Naradmuni.');
                    showStatus('Please sign in to continue', 'warning');
                    return;
                }
                sendMessage(prompt);
            };

            const AvatarComponent = ({ className }) => {
                return (
                    <div className={className}>
                        N
                    </div>
                );
            };

            return (
                <div className="app">
                    {/* Status Indicator */}
                    <div className={`status-indicator ${statusMessage ? 'show' : ''} ${statusType}`}>
                        {statusMessage}
                    </div>

                    {/* Sidebar Overlay */}
                    <div 
                        className={`sidebar-overlay ${sidebarOpen ? 'visible' : ''}`}
                        onClick={closeSidebar}
                    />
                    
                    {/* Enhanced Sidebar */}
                    <div className={`sidebar ${sidebarOpen ? 'open' : ''}`}>
                        <div className="sidebar-header">
                            <div className="sidebar-logo">
                                <AvatarComponent className="sidebar-avatar" />
                                <span className="sidebar-title">Naradmuni</span>
                            </div>
                            <button className="sidebar-close" onClick={closeSidebar}>
                                ✕
                            </button>
                        </div>
                        
                        <div className="sidebar-content">
                            <div className="sidebar-section">
                                <h3>🕊️ About Your Guide</h3>
                                <div className="feature-card">
                                    <div className="feature-icon">🧘‍♂️</div>
                                    <h4>Wise Counselor</h4>
                                    <p>Ancient wisdom meets modern understanding to guide you through life's challenges with compassion and insight.</p>
                                </div>
                            </div>

                            <div className="sidebar-section">
                                <h3>✨ Key Features</h3>
                                <div className="feature-card">
                                    <div className="feature-icon">💭</div>
                                    <h4>Personalized Guidance</h4>
                                    <p>Thoughtful advice tailored to your unique situation and life circumstances.</p>
                                </div>
                                <div className="feature-card">
                                    <div className="feature-icon">🌟</div>
                                    <h4>Holistic Approach</h4>
                                    <p>Addressing mind, body, and spirit for complete well-being and growth.</p>
                                </div>
                            </div>

                            {user && messages.length > 0 && (
                                <div className="sidebar-section">
                                    <h3>📊 Session Stats</h3>
                                    <div className="stats-grid">
                                        <div className="stat-item">
                                            <span className="stat-value">{messages.filter(m => m.type === 'user').length}</span>
                                            <span className="stat-label">Questions</span>
                                        </div>
                                        <div className="stat-item">
                                            <span className="stat-value">{messages.filter(m => m.type === 'bot').length}</span>
                                            <span className="stat-label">Insights</span>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>

                    {/* Main Content */}
                    <div className="main-content">
                        <div className="header">
                            <button className="menu-button" onClick={toggleSidebar}>
                                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5">
                                    <path d="M3 12h18M3 6h18M3 18h18" strokeLinecap="round"/>
                                </svg>
                            </button>
                            <AvatarComponent className="header-avatar" />
                            <div className="header-content">
                                <h1 className="header-title">Naradmuni</h1>
                                <p className="header-subtitle">Your Wise Life Guide</p>
                            </div>
                            
                            <div className="auth-section">
                                {user ? (
                                    <div className="profile-menu" ref={profileMenuRef}>
                                        <div className="profile-button" onClick={toggleProfileMenu}>
                                            <img src={user.picture} alt="User Avatar" className="profile-avatar" />
                                            <div className="profile-info">
                                                <div className="profile-name">{user.name}</div>
                                                <div className="profile-email">{user.email}</div>
                                            </div>
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                                <path d="m7 10 5 5 5-5" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                                            </svg>
                                        </div>
                                        <div className={`profile-dropdown ${profileMenuOpen ? 'open' : ''}`}>
                                            <div className="profile-menu-item">
                                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                                    <circle cx="12" cy="7" r="4"/>
                                                </svg>
                                                <div>
                                                    <div style={{ fontWeight: '600' }}>{user.name}</div>
                                                    <div style={{ fontSize: '0.75rem', color: 'var(--text-secondary)' }}>{user.email}</div>
                                                </div>
                                            </div>
                                            <div className="menu-divider"></div>
                                            <div className="profile-menu-item theme-toggle" onClick={toggleTheme}>
                                                <div style={{ display: 'flex', alignItems: 'center', gap: '0.75rem' }}>
                                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                                        {theme === 'light' ? (
                                                            <circle cx="12" cy="12" r="5"/>
                                                        ) : (
                                                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                                                        )}
                                                        <g>
                                                            {theme === 'light' && (
                                                                <>
                                                                    <line x1="12" y1="1" x2="12" y2="3"/>
                                                                    <line x1="12" y1="21" x2="12" y2="23"/>
                                                                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                                                                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                                                                    <line x1="1" y1="12" x2="3" y2="12"/>
                                                                    <line x1="21" y1="12" x2="23" y2="12"/>
                                                                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                                                                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                                                                </>
                                                            )}
                                                        </g>
                                                    </svg>
                                                    <span>{theme === 'light' ? 'Light Mode' : 'Dark Mode'}</span>
                                                </div>
                                                <div className="theme-toggle-switch"></div>
                                            </div>
                                            <div className="profile-menu-item">
                                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                                    <path d="M14 9V5a3 3 0 0 0-6 0v4"/>
                                                    <rect x="2" y="9" width="20" height="11" rx="2" ry="2"/>
                                                </svg>
                                                <span>Privacy & Security</span>
                                            </div>
                                            <div className="menu-divider"></div>
                                            <div className="profile-menu-item" onClick={handleLogout}>
                                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                                                    <polyline points="16,17 21,12 16,7"/>
                                                    <line x1="21" y1="12" x2="9" y2="12"/>
                                                </svg>
                                                <span>Sign Out</span>
                                            </div>
                                        </div>
                                    </div>
                                ) : (
                                    <div className="login-container">
                                        <span className="login-text">Ready to begin your journey?</span>
                                        <div ref={googleButtonRef}>
                                            {renderGoogleSignInButton()}
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>

                        <div className="chat-container">
                            <div className="messages">
                                {messages.length === 0 ? (
                                    <div className="welcome-area">
                                        <div className="welcome-hero">
                                            <AvatarComponent className="welcome-avatar" />
                                            <div className="welcome-content">
                                                <h2>Welcome to Naradmuni</h2>
                                                <p>
                                                    {user ? 
                                                        `Namaste, ${user.name.split(' ')[0]}! I'm here to provide thoughtful guidance on life's journey. Whether you're seeking wisdom on relationships, career, personal growth, or finding inner peace, I'm here to listen with compassion and share insights rooted in both ancient wisdom and modern understanding.` :
                                                        "Please sign in with Google to begin your conversation with me. I'm here to provide thoughtful guidance on relationships, career, wellness, personal growth, and life's most important questions."
                                                    }
                                                </p>
                                            </div>
                                        </div>
                                        
                                        {user && (
                                            <div className="suggestions-grid">
                                                {suggestions.map((suggestion, index) => (
                                                    <div
                                                        key={index}
                                                        className="suggestion-card"
                                                        onClick={() => handleSuggestionClick(suggestion.prompt)}
                                                    >
                                                        <div className="suggestion-icon">{suggestion.icon}</div>
                                                        <h4>{suggestion.title}</h4>
                                                        <p>{suggestion.description}</p>
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                ) : (
                                    messages.map((message) => (
                                        <div key={message.id} className={`message ${message.type}`}>
                                            {message.type === 'bot' && (
                                                <AvatarComponent className="message-avatar" />
                                            )}
                                            <div className="message-bubble">
                                                <div className="message-content">
                                                    <div 
                                                        className="formatted-message"
                                                        dangerouslySetInnerHTML={{
                                                            __html: formatMessage(message.content)
                                                        }}
                                                    />
                                                </div>
                                            </div>
                                        </div>
                                    ))
                                )}
                                
                                {isLoading && (
                                    <div className="loading-message">
                                        <AvatarComponent className="loading-avatar" />
                                        <div className="loading-bubble">
                                            <div className="loading-content">
                                                <div className="thinking-animation">
                                                    <span className="brain-icon">🧠</span>
                                                    <span>{thinkingMessages[currentThinkingMessage]}</span>
                                                </div>
                                                <div className="loading-dots">
                                                    <div className="loading-dot"></div>
                                                    <div className="loading-dot"></div>
                                                    <div className="loading-dot"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                )}
                                
                                {error && (
                                    <div className="error-message">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                            <circle cx="12" cy="12" r="10"/>
                                            <line x1="15" y1="9" x2="9" y2="15" stroke="white" strokeWidth="2"/>
                                            <line x1="9" y1="9" x2="15" y2="15" stroke="white" strokeWidth="2"/>
                                        </svg>
                                        {error}
                                    </div>
                                )}

                                {tokenLimitExceeded && (
                                    <div className="token-limit-message">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                            <circle cx="12" cy="12" r="10"/>
                                            <path d="M12 6v6l4 2" stroke="white" strokeWidth="2" strokeLinecap="round"/>
                                        </svg>
                                        You've reached the conversation limit for now. Please take a moment to reflect on our discussion and try again after some time.
                                    </div>
                                )}

                                {characterLimitExceeded && (
                                    <div className="character-limit-message">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                            <polyline points="14,2 14,8 20,8" stroke="white" strokeWidth="2" fill="none"/>
                                            <line x1="16" y1="13" x2="8" y2="13" stroke="white" strokeWidth="2"/>
                                            <line x1="16" y1="17" x2="8" y2="17" stroke="white" strokeWidth="2"/>
                                        </svg>
                                        Message exceeds {CHARACTER_LIMIT} character limit. Please shorten your message to continue our conversation.
                                    </div>
                                )}
                                
                                <div ref={messagesEndRef} />
                            </div>

                            {user && (
                                <div className="input-area">
                                    <div className="input-container">
                                        <div className="input-wrapper">
                                            <textarea
                                                className="message-input"
                                                placeholder="Share what's on your mind and heart... I'm here to listen and guide."
                                                value={inputMessage}
                                                onChange={handleInputChange}
                                                onKeyPress={handleKeyPress}
                                                disabled={isLoading || tokenLimitExceeded}
                                                rows="1"
                                                maxLength={CHARACTER_LIMIT}
                                            />
                                            <div className={`character-counter ${characterCount > CHARACTER_LIMIT * 0.8 ? characterCount > CHARACTER_LIMIT ? 'error' : 'warning' : ''}`}>
                                                {characterCount}/{CHARACTER_LIMIT}
                                            </div>
                                        </div>
                                        <button
                                            className="send-button"
                                            onClick={() => sendMessage()}
                                            disabled={!inputMessage.trim() || isLoading || tokenLimitExceeded || characterLimitExceeded || characterCount > CHARACTER_LIMIT}
                                        >
                                            {isLoading ? (
                                                <>
                                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" style={{ marginRight: '0.5rem' }}>
                                                        <path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/>
                                                        <animateTransform attributeName="transform" type="rotate" values="0 12 12;360 12 12" dur="1s" repeatCount="indefinite"/>
                                                    </svg>
                                                    Reflecting...
                                                </>
                                            ) : (
                                                <>
                                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" style={{ marginRight: '0.5rem' }}>
                                                        <path d="M2 21l21-9L2 3v7l15 2-15 2v7z"/>
                                                    </svg>
                                                    Send
                                                </>
                                            )}
                                        </button>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>